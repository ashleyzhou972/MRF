salloc -N1 -t 1:00:00

module load gcc/6.4.0-vddll7o
module load curl
#module load r/3.5.0-py2-qqwf6c6
export LD_LIBRARY_PATH=/work/friedberg_lab/configure/R-3.5.1/src/nmath/standalone:$LD_LIBRARY_PATH


#Because we can't access the Rmath.h and libRmath.so files in the condo R
#install a local R

wget https://cran.r-project.org/src/base/R-3/R-3.5.1.tar.gz
tar -xvzf R-3.5.1.tar.gz
cd R-3.5.1
./configure --prefix=/work/friedberg_lab/configure/R_make --enable-r-shlib=yes
make
make install
cd src/nmath/standalone
make

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/work/friedberg_lab/configure/R-3.5.1/src/nmath/standalone

#This is the R to use:
/work/friedberg_lab/nzhou/configure/R_make/bin/R

#Below is to create the R_CMD_SHLB_* files
#/work/friedberg_lab/nzhou/configure/R_make/bin/R CMD SHLIB dm_call.c double_metropolis.c regular_metropolis.c negpotential.c

#Use 
./R_CMD_SHLIB_poisson_condo_new
#to compile dm_call.so


#Add this line 
LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/work/friedberg_lab/nzhou/configure/R-3.5.1/src/nmath/standalone
#to
/work/friedberg_lab/nzhou/configure/R_make/lib64/R/etc/ldpaths


######################################################################
#contents of R_CMD_SHLIB_poisson_condo_new
gcc -std=gnu99 -I"/work/friedberg_lab/nzhou/configure/R-3.5.1/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c dm_call.c -o dm_call.o
gcc -std=gnu99 -I"/work/friedberg_lab/nzhou/configure/R-3.5.1/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c double_metropolis.c -o double_metropolis.o
gcc -std=gnu99 -I"/work/friedberg_lab/nzhou/configure/R-3.5.1/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c negpotential.c -o negpotential.o -fopenmp -DOPENMP
gcc -std=gnu99 -I"/work/friedberg_lab/nzhou/configure/R-3.5.1/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c regular_metropolis.c -o regular_metropolis.o
gcc -std=gnu99 -shared -L/usr/local/lib64 -o dm_call.so dm_call.o double_metropolis.o negpotential.o regular_metropolis.o -L/work/friedberg_lab/nzhou/configure/R_make/lib64/R/lib -lR  -fopenmp -DOPENMP -I"/work/friedberg_lab/nzhou/configure/R-3.5.1/include" -L/work/friedberg_lab/nzhou/configure/R-3.5.1/src/nmath/standalone -lRmath
#generated by
#/work/friedberg_lab/nzhou/configure/R_make/bin/R CMD SHLIB dm_call.c double_metropolis.c regular_metropolis.c negpotential.c
and modified to have -L -I and -fopenmp flags
